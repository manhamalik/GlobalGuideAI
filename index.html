<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Convergence" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Josefin+Sans" />
    <title>GlobalGuideAI</title>
    <style>
      body {
            /* background-color: #213c4b; */
          background-image: url('https://static.videezy.com/system/resources/thumbnails/000/043/897/original/200206_01_Particle-star-fall-seamless-loop.jpg');
        
/* https://images.unsplash.com/photo-1620646233562-f2a31ad24425?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8c3RhcnMlMjBibGFja3xlbnwwfHwwfHx8MA%3D%3D&w=1000&q=80 */
        }
      
      @import url(https://fonts.googleapis.com/css?family=Share+Tech+Mono);
      body, html {
          height: 100%;
          margin: 0;
          padding: 0;
        }
      
        .container {
            width: 55vw;
            margin: 0 auto;
            padding: 20px;
            border-radius: 20px;
            border: 1px solid #ccc; 
            box-sizing: border-box;
            overflow: auto;
            height: 100vh;
            background-color: #000000;
            position: relative;
            margin-bottom: 20px;
        }

        .spacer{
          height: 1px;
          visibility: hidden;
        }

        .message-container {
            max-height: calc(100vh - 150px); 
            overflow-y: auto;
            margin-bottom: 10px;
        }
        .chatbot-message {
            background-color: #477BE7;
            color: #ffffff;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 20px;
            display: inline-block; 
            white-space: pre-wrap;
        }

        .user-message {
            background-color: #1345A9;
            color: #ffffff;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 20px;
            text-align: right;
            width: fit-content;
            margin-left: auto;
        }
      
        .submit-container {
          border-top: 1px solid #ccc;
          width: calc(55vw - 60px);
          padding-top: 5px;
          padding-bottom: 15px;
          align-items: center;
          justify-content: center;
          position: absolute;
          bottom: 0;
          left: 50%;
          transform: translateX(-50%); 
        }

      h1 {
        color: #ffffff;
      }

      h3 {
        color: #ffffff;
        padding-bottom: 10px;
        border-bottom: 1px solid #ccc;
      }
      
      #user-message-input {
        flex: 1;
        width: calc(100% - 100px);
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

      #submit-button {
        flex: 1;
        background-color: transparent;
        border: none;
        cursor: pointer;
        position: relative;
        top: 5px;
      }
      
      .top-container {
        background-color: #020204;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin-bottom: 20px;
      }
      
      .top-container img {
        display: block;
        max-width: 100%;
        margin-bottom: 20px;
        }
      
      .top-container .text-container {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: flex-start;
          padding: 10px;
          color: #FFF;
          max-width: 50%;
          margin-right: 50px;
          text-align: center;
          color: #FFF;
      }

      .top-container h1 {
          font-size: 24px;
          margin-bottom: 10px;
        font-family: Josefin Sans;
      }

      .top-container h2 {
          font-size: 18px;
          font-family: "Share Tech Mono", monospace;
          visibility: hidden;                
          overflow: hidden; /* Ensures the content is not revealed until the animation */
          border-right: .15em solid orange;
          white-space: nowrap; /* Keeps the content on a single line */
          margin: 0 auto; /* Gives that scrolling effect as the typing happens */
          letter-spacing: .15em; /* Adjust as needed */
          animation: 
          typing 3.5s steps(40, end) 2.5s forwards,
          blink-caret .75s step-end infinite 2.5s;
      }
      /* The typing effect */
      @keyframes typing {
        from { width: 0; visibility: visible;}
        to { width: 100%; visibility: visible;}
      }

      /* The typewriter cursor effect */
      @keyframes blink-caret {
        from, to { border-color: transparent }
        50% { border-color: orange; }
      }

      /* decode effect */
      .decode-text {
        width: 100%;
        font-size: 30px;
        text-align: center;
      }
      .space {
        display: inline-block;
        width: 10px;
      }
      .text-animation {
        display: inline-block;
        position: relative;
        color: transparent;
        text-transform: uppercase;
        &:before {
          content: "";
          color: white;
          position: absolute;
          top: 50%;
          left: 50%;
          background: white;
          width: 0;
          height: 1.2em;
          -webkit-transform: translate(-50%, -55%);
          -ms-transform: translate(-50%, -55%);
          transform: translate(-50%, -55%);
        }

        &.state-1 {
          &:before {
            width: 1px;
          }
        }
        &.state-2 {
          &:before {
            width: 0.9em;
          }
        }
        &.state-3 {
          color: white;
            &:before {
              width: 0;
            }
        }
      }
    </style>
</head>
  
<body onload=decodeText();>
   <!-- <img src="global.gif" alt="Globe Gif"> -->
  <!-- <img src="images/global.gif" alt="GIF image" style="width: 100%; position: absolute; top: 0;"> -->
  <div class="top-container">
    <div class="text-container">
          <!-- <center> <h1>Hello, Welcome to GlobalGuideAI!</h1> -->
      <!-- decode effect -->
      <div class="decode-text">
  	  <div class="text-animation">G</div>
  	  <div class="text-animation">l</div>
   	  <div class="text-animation">o</div>
      <div class="text-animation">b</div>
      <div class="text-animation">a</div>
      <div class="text-animation">l</div>
      <div class="space"></div>

  	  <div class="text-animation">G</div>
  	  <div class="text-animation">u</div>
    	<div class="text-animation">i</div>
      <div class="text-animation">d</div>
      <div class="text-animation">e</div>
      <div class="space"></div>

      <div class="text-animation">A</div>
      <div class="text-animation">I</div>

    </div>

          <center> <h2>Discover the World's Hidden Treasures</h2>
        </div>
  <img src="https://cdn.pixabay.com/animation/2022/12/24/01/36/01-36-27-376_512.gif">
  </div>
  
    <div class="container">
        <center><h1>Welcome to the GlobalGuideAI</h1></center>
      <center><h3>We have information on the following cities: <br> Paris, Dubai, Toronto, Tokyo, Istanbul, Melbourne, London, New York City, and Rome.</h3></center>
      <div class="message-container" id="chatbox">
            {% for message in chat_history %}
                <div class="{{ message[0] }}-message">{{ message[1] }}</div>
            {% endfor %}
        </div>
    <center> <div class="submit-container">
      <form id="message-form" action="/send-message" method="POST">
        <input type="text" id="user-message-input" name="user_message" placeholder="Enter your message">
        <button type="submit" id="submit-button">
          <img src="https://img.freepik.com/free-icon/_318-157681.jpg" alt="Submit" style="width: 20px; height: 25px;">
          <!-- https://img.freepik.com/free-icon/sent_318-879118.jpg?w=360 -->
        </button>
      </form>
    </div>
  </div>
  <div class="spacer"></div>

  <script>
const chatbox = document.getElementById("chatbox");
const messageForm = document.getElementById("message-form");
const userMessageInput = document.getElementById("user-message-input");

messageForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const userMessage = userMessageInput.value;
    appendUserMessage(userMessage);
    userMessageInput.value = "";
    sendMessageToChatbot(userMessage);
});

function appendUserMessage(message) {
    const userMessageElement = document.createElement("div");
    userMessageElement.className = "user-message";
    userMessageElement.textContent = message;
    chatbox.appendChild(userMessageElement);
}

function appendChatbotMessage(message) {
    const chatbotMessageElement = document.createElement("div");
    chatbotMessageElement.className = "chatbot-message";
    chatbotMessageElement.innerHTML = message;
    chatbox.appendChild(chatbotMessageElement);
}

function sendMessageToChatbot(message) {
    const xhr = new XMLHttpRequest();
    xhr.open("POST", "/send-message");
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xhr.onload = function () {
        if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            appendChatbotMessage(response.reply);
        }
    };
    const data = new URLSearchParams();
    data.append("user_message", message);
    xhr.send(data);
}   

    // decode effect on title experiment
    /* ------------------------------------------------------------------------ *  
4 states per letter: Transparent | Line | Block | Visible.
These states are shuffled for a unique "decode" effect each time.
* ------------------------------------------------------------------------ */

function decodeText(){
    var text = document.getElementsByClassName('decode-text')[0];
    // debug with
    // console.log(text, text.children.length);

    // assign the placeholder array its places
    var state = [];
    for(var i = 0, j = text.children.length; i < j; i++ ){
        text.children[i].classList.remove('state-1','state-2','state-3');
        state[i] = i;
    }

    // shuffle the array to get new sequences each time
    var shuffled = shuffle(state);
 
    for(var i = 0, j = shuffled.length; i < j; i++ ){
        var child = text.children[shuffled[i]];
        classes = child.classList;

        // fire the first one at random times
        var state1Time = Math.round( Math.random() * (2000 - 300) ) + 50;
        if(classes.contains('text-animation')){ 
            setTimeout(firstStages.bind(null, child), state1Time);
        }
    }
}

// send the node for later .state changes
function firstStages(child){
    if( child.classList.contains('state-2') ){   
        child.classList.add('state-3');
    } else if( child.classList.contains('state-1') ){
        child.classList.add('state-2')
    } else if( !child.classList.contains('state-1') ){
        child.classList.add('state-1');
        setTimeout(secondStages.bind(null, child), 100);
    }    
}
function secondStages(child){
    if( child.classList.contains('state-1') ){
        child.classList.add('state-2')
        setTimeout(thirdStages.bind(null, child), 100);
    } 
    else if( !child.classList.contains('state-1') )
    {
        child.classList.add('state-1')
    }
}
function thirdStages(child){
    if( child.classList.contains('state-2') ){
        child.classList.add('state-3')
    }
}

function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {
        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }
    return array;
}
  </script>
</body>
</html>